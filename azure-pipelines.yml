trigger:
- master
jobs:

- job: Linux
  pool:
    vmImage: 'ubuntu-16.04'
  container:
    image: 'ubuntu:18.04'
    options: "--name ci-container -v /usr/bin/docker:/tmp/docker:ro"
  steps:
  - script: |
      /tmp/docker exec -t -u 0 ci-container \
      sh -c "apt-get update && DEBIAN_FRONTEND=noninteractive apt-get -o Dpkg::Options::="--force-confold" -y install sudo"
    displayName: set up sudo
  - checkout: self
    submodules: true
  - script: |
      whoami
      pwd
      sudo apt-get install -y \
        cmake libgmp-dev libmpfr-dev libmpc-dev \
        libboost-all-dev bison texinfo \
        ruby
    displayName: 'install prerequisites'
  - script: |
      mkdir build
      cd build
      ../build-toolchain.bash --no-carbon
    displayName: 'build'

- job: macOS
  pool:
    vmImage: 'macOS-10.14'
  steps:
  - checkout: self
    submodules: true
  - script: |
      brew install boost cmake gmp mpfr libmpc bison
    displayName: 'brew prerequisites'
  - script: |
      mkdir build
      cd build
      ../build-toolchain.bash --no-carbon
    displayName: build
